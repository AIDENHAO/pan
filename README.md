# ä¿®ä»™å®—é—¨ç®¡ç†ç³»ç»Ÿ

ä¸€ä¸ªåŸºäº React + TypeScript + Express + MySQL æ„å»ºçš„ç°ä»£åŒ–ä¿®ä»™å®—é—¨ç®¡ç†åº”ç”¨ï¼Œæä¾›å®Œæ•´çš„å‰åç«¯åˆ†ç¦»æ¶æ„ã€æ•°æ®åº“è¿æ¥æ± å’Œä¸°å¯Œçš„åŠŸèƒ½æ¨¡å—ã€‚

## ğŸŒŸ é¡¹ç›®ç‰¹è‰²

- **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**: React 18 + TypeScript + Express + MySQL + Vite
- **å®Œæ•´çš„å‰åç«¯åˆ†ç¦»**: RESTful API è®¾è®¡
- **ç±»å‹å®‰å…¨**: å…¨é¢çš„ TypeScript ç±»å‹å®šä¹‰
- **å››å±‚æ¶æ„è®¾è®¡**: æ§åˆ¶å™¨-æœåŠ¡-DAL-æ•°æ®åº“åˆ†å±‚æ¶æ„
- **æ•°æ®åº“è¿æ¥æ± **: MySQLè¿æ¥æ± ä¼˜åŒ–ï¼Œæ”¯æŒé«˜å¹¶å‘
- **å“åº”å¼ç•Œé¢**: ç°ä»£åŒ–çš„ä¿®ä»™ä¸»é¢˜ UI
- **çƒ­æ¨¡å—æ›¿æ¢**: å¼€å‘ç¯å¢ƒä¸‹çš„å¿«é€Ÿè¿­ä»£
- **å®Œæ•´çš„æ•°æ®æŒä¹…åŒ–**: 17ä¸ªæ•°æ®åº“è¡¨ï¼Œæ”¯æŒå¤æ‚ä¸šåŠ¡é€»è¾‘

## ğŸš€ æŠ€æœ¯æ ˆ

### å‰ç«¯
- **React 18**: ç°ä»£åŒ–çš„ç”¨æˆ·ç•Œé¢åº“
- **TypeScript**: ç±»å‹å®‰å…¨çš„ JavaScript è¶…é›†
- **Vite**: å¿«é€Ÿçš„å‰ç«¯æ„å»ºå·¥å…·
- **React Router**: å•é¡µåº”ç”¨è·¯ç”±ç®¡ç†
- **CSS3**: ç°ä»£åŒ–æ ·å¼è®¾è®¡

### åç«¯
- **Node.js**: JavaScript è¿è¡Œæ—¶ç¯å¢ƒ
- **Express**: è½»é‡çº§ Web åº”ç”¨æ¡†æ¶
- **TypeScript**: æœåŠ¡ç«¯ç±»å‹å®‰å…¨
- **MySQL**: å…³ç³»å‹æ•°æ®åº“ï¼Œæ”¯æŒè¿æ¥æ± 
- **mysql2**: é«˜æ€§èƒ½MySQLé©±åŠ¨
- **CORS**: è·¨åŸŸèµ„æºå…±äº«æ”¯æŒ

### æ•°æ®åº“
- **MySQL 8.0+**: ä¸»æ•°æ®åº“ç³»ç»Ÿ
- **è¿æ¥æ± æ¶æ„**: æ”¯æŒå¹¶å‘è¿æ¥ï¼Œæœ€å¤§10ä¸ªè¿æ¥
- **äº‹åŠ¡æ”¯æŒ**: å®Œæ•´çš„ACIDäº‹åŠ¡å¤„ç†
- **17ä¸ªæ•°æ®è¡¨**: å®Œæ•´çš„ä¿®ä»™æ¸¸æˆæ•°æ®æ¨¡å‹

## ğŸ“ é¡¹ç›®ç»“æ„

```
React-TypeScript/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/          # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ pages/              # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ LeaderPage.tsx      # æŒé—¨ä¿¡æ¯é¡µé¢
â”‚   â”‚   â”œâ”€â”€ DisciplesPage.tsx   # å¼Ÿå­ç®¡ç†é¡µé¢
â”‚   â”‚   â”œâ”€â”€ ResourcesPage.tsx   # å®—é—¨èµ„æºé¡µé¢
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ controllers/        # åç«¯æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”œâ”€â”€ BaseController.ts   # åŸºç¡€æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ LeaderController.ts # æŒé—¨æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ ZongmenController.ts # å®—é—¨æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ DatabaseController.ts # æ•°æ®åº“æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ routes/             # API è·¯ç”±å±‚
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚
â”‚   â”œâ”€â”€ database/           # æ•°æ®åº“å±‚
â”‚   â”‚   â”œâ”€â”€ config/             # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ database.ts         # è¿æ¥æ± é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ init.ts            # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ implementations/    # DALå®ç°å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ DatabaseService.ts  # æ•°æ®åº“æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ DALFactory.ts      # DALå·¥å‚
â”‚   â”‚   â”‚   â””â”€â”€ CharacterDALs/     # è§’è‰²æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ interfaces/         # æ•°æ®åº“æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ examples/          # ä½¿ç”¨ç¤ºä¾‹
â”‚   â”‚   â””â”€â”€ README.md          # æ•°æ®åº“æ–‡æ¡£
â”‚   â”œâ”€â”€ data/              # é™æ€æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ types/             # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ styles/            # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ server/            # æœåŠ¡å™¨é…ç½®
â”œâ”€â”€ public/                # é™æ€èµ„æº
â”œâ”€â”€ docs/                  # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ æ•°æ®åº“æ¶æ„ä¼˜åŒ–æ–¹æ¡ˆ.md
â”‚   â”œâ”€â”€ æ•°æ®åº“ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š.md
â”‚   â””â”€â”€ å››å±‚æ¶æ„åº”ç”¨å»ºè®®æ–‡æ¡£.md
â”œâ”€â”€ CHANGELOG.md           # é¡¹ç›®å˜æ›´æ—¥å¿—
â””â”€â”€ package.json          # é¡¹ç›®ä¾èµ–é…ç½®
```

## ğŸ› ï¸ å®‰è£…ä¸è¿è¡Œ

### ç¯å¢ƒè¦æ±‚
- Node.js >= 16.0.0
- npm >= 8.0.0
- MySQL >= 8.0.0

### æ•°æ®åº“é…ç½®

1. **å®‰è£…MySQL**
   ```bash
   # Ubuntu/Debian
   sudo apt update
   sudo apt install mysql-server
   
   # macOS (ä½¿ç”¨Homebrew)
   brew install mysql
   
   # Windows: ä¸‹è½½MySQLå®‰è£…åŒ…
   ```

2. **åˆ›å»ºæ•°æ®åº“**
   ```sql
   CREATE DATABASE xiuxian_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   CREATE USER 'xiuxian_user'@'localhost' IDENTIFIED BY 'your_password';
   GRANT ALL PRIVILEGES ON xiuxian_db.* TO 'xiuxian_user'@'localhost';
   FLUSH PRIVILEGES;
   ```

3. **é…ç½®æ•°æ®åº“è¿æ¥**
   
   åœ¨ `src/database/config/database.ts` ä¸­é…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š
   ```typescript
   const config = {
     host: 'localhost',
     user: 'xiuxian_user',
     password: 'your_password',
     database: 'xiuxian_db',
     connectionLimit: 10,
     queueLimit: 0
   };
   ```

### å®‰è£…ä¾èµ–
```bash
npm install
```

### å¼€å‘ç¯å¢ƒè¿è¡Œ

#### å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
```bash
npm run dev
```
å‰ç«¯æœåŠ¡å°†è¿è¡Œåœ¨: http://localhost:3004

#### å¯åŠ¨åç«¯ TypeScript æœåŠ¡å™¨
```bash
npm run server
```
åç«¯ API æœåŠ¡å°†è¿è¡Œåœ¨: http://localhost:3015

#### å¯åŠ¨åç«¯å¼€å‘æ¨¡å¼ï¼ˆå¸¦çƒ­é‡è½½ï¼‰
```bash
npm run server:dev
```

#### å¯åŠ¨æ—§ç‰ˆ JavaScript æœåŠ¡å™¨ï¼ˆå…¼å®¹æ¨¡å¼ï¼‰
```bash
npm run server:old
```

### ç”Ÿäº§ç¯å¢ƒæ„å»º
```bash
npm run build
```

## ğŸ“š API æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯
- **Base URL**: `http://localhost:3015`
- **Content-Type**: `application/json`
- **è¯·æ±‚æ–¹æ³•**: ä¸»è¦ä½¿ç”¨ POST

### API ç«¯ç‚¹

#### 1. å¥åº·æ£€æŸ¥
```http
GET /api/health
```
**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "ok",
  "timestamp": "2025-07-29T09:31:17.126Z",
  "port": 3015
}
```

#### 2. è·å–æŒé—¨ä¿¡æ¯
```http
POST /api/get-person-info
```
**è¯·æ±‚ä½“**:
```json
{
  "id": "leader001"
}
```
**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "success",
  "data": {
    "id": "leader_001",
    "name": "å¼ é’äº‘",
    "title": "é’äº‘çœŸäºº",
    "realmLevel": 20,
    "cultivationValue": 17,
    "skills": ["é’äº‘å‰‘è¯€", "å¾¡å‰‘æœ¯", "æ¸…å¿ƒè¯€"],
    "canBreakthrough": true,
    "positionName": "å®—ä¸»"
  },
  "message": "äººç‰©ä¿¡æ¯è·å–æˆåŠŸ"
}
```

#### 3. è·å–å®—é—¨ä¿¡æ¯
```http
POST /api/get-zongmen-info
```
**è¯·æ±‚ä½“**:
```json
{
  "id": "zongmen001"
}
```
**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "success",
  "data": {
    "discipleCount": 156,
    "sectLevel": 4,
    "sectReputation": 8750,
    "disciples": [...],
    "resources": {
      "spiritStone": 15000,
      "herbs": 350,
      "magicWeapons": 42,
      "treasures": 18
    }
  },
  "message": "å®—é—¨ä¿¡æ¯è·å–æˆåŠŸ"
}
```

#### 4. æ›´æ–°ä¿®ç‚¼å€¼
```http
POST /api/update-cultivation
```
**è¯·æ±‚ä½“**:
```json
{
  "id": "leader001",
  "increaseValue": 5
}
```

#### 5. æ¿€æ´»çªç ´
```http
POST /api/activate-breakthrough
```
**è¯·æ±‚ä½“**:
```json
{
  "id": "leader001"
}
```

#### 6. è·å–æ˜ å°„æ•°æ®
```http
POST /api/get-mappings
```
**å“åº”åŒ…å«**: å¢ƒç•Œç­‰çº§æ˜ å°„ã€èŒä½æ˜ å°„ã€åŠŸæ³•æŠ€èƒ½æ•°æ®

#### 7. æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯
```http
GET /api/database/stats
```
**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "success",
  "data": {
    "connectionPool": {
      "totalConnections": 10,
      "activeConnections": 2,
      "idleConnections": 8
    },
    "tables": {
      "character_base_info": 156,
      "character_cultivation": 156,
      "realm_data": 20
    },
    "health": "healthy"
  }
}
```

#### 8. æ•°æ®åº“å¥åº·æ£€æŸ¥
```http
GET /api/database/health
```
**å“åº”ç¤ºä¾‹**:
```json
{
  "status": "success",
  "data": {
    "database": "connected",
    "connectionPool": "healthy",
    "lastCheck": "2025-07-30T10:30:00.000Z"
  }
}
```

## ğŸ® åŠŸèƒ½æ¨¡å—

### æŒé—¨ç®¡ç†
- æŸ¥çœ‹æŒé—¨åŸºæœ¬ä¿¡æ¯ï¼ˆå§“åã€ç§°å·ã€å¢ƒç•Œç­‰çº§ï¼‰
- ä¿®ç‚¼å€¼ç®¡ç†å’Œå¢é•¿
- å¢ƒç•Œçªç ´åŠŸèƒ½
- æŠ€èƒ½å±•ç¤º

### å®—é—¨ç®¡ç†
- å®—é—¨åŸºæœ¬ä¿¡æ¯å±•ç¤º
- å¼Ÿå­æ•°é‡å’Œç­‰çº§ç»Ÿè®¡
- å®—é—¨èµ„æºç®¡ç†ï¼ˆçµçŸ³ã€è‰è¯ã€æ³•å™¨ã€å®ç‰©ï¼‰
- æ ¸å¿ƒå¼Ÿå­ä¿¡æ¯

### åŠŸæ³•ç³»ç»Ÿ
- åŠŸæ³•æŠ€èƒ½å¤§å…¨
- æŠ€èƒ½ç­‰çº§å’Œå±æ€§å±•ç¤º
- ä¿®ç‚¼è¦æ±‚å’Œèµ„æºéœ€æ±‚
- æŠ€èƒ½åˆ†ç±»å’Œå“çº§

### å…¶ä»–åŠŸèƒ½
- ä¿®ç‚¼æŒ‡å—
- ä»»åŠ¡ç³»ç»Ÿï¼ˆå¼€å‘ä¸­ï¼‰
- äº¤æ˜“å¸‚åœºï¼ˆå¼€å‘ä¸­ï¼‰
- å®—é—¨äº‹ä»¶ï¼ˆå¼€å‘ä¸­ï¼‰
- ç³»ç»Ÿè®¾ç½®

## ğŸ”§ å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ
- ä½¿ç”¨ TypeScript è¿›è¡Œç±»å‹å®‰å…¨å¼€å‘
- éµå¾ª ESLint ä»£ç è§„èŒƒ
- ç»„ä»¶å’Œå‡½æ•°å‘½åé‡‡ç”¨é©¼å³°å‘½åæ³•
- æ¥å£å’Œç±»å‹å®šä¹‰ä½¿ç”¨ PascalCase
- å¸¸é‡ä½¿ç”¨ UPPER_SNAKE_CASE

### é¡¹ç›®æ¶æ„

æœ¬é¡¹ç›®é‡‡ç”¨å››å±‚æ¶æ„è®¾è®¡ï¼Œç¡®ä¿ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼š

#### 1. æ§åˆ¶å™¨å±‚ (Controllers)
- å¤„ç† HTTP è¯·æ±‚å’Œå“åº”
- å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†
- è°ƒç”¨æœåŠ¡å±‚è¿›è¡Œä¸šåŠ¡å¤„ç†
- ä½ç½®ï¼š`src/controllers/`

#### 2. æœåŠ¡å±‚ (Services)
- ä¸šåŠ¡é€»è¾‘å¤„ç†å’Œç¼–æ’
- è·¨DALçš„å¤æ‚æ“ä½œ
- æ•°æ®è½¬æ¢å’Œä¸šåŠ¡è§„åˆ™
- ä½ç½®ï¼š`src/services/`

#### 3. æ•°æ®è®¿é—®å±‚ (DAL)
- æ•°æ®åº“æ“ä½œçš„æŠ½è±¡
- SQLæŸ¥è¯¢å’Œäº‹åŠ¡ç®¡ç†
- æ•°æ®æ¨¡å‹æ˜ å°„
- ä½ç½®ï¼š`src/database/implementations/`

#### 4. æ•°æ®åº“å±‚ (Database)
- MySQLè¿æ¥æ± ç®¡ç†
- æ•°æ®åº“é…ç½®å’Œåˆå§‹åŒ–
- è¿æ¥å¥åº·æ£€æŸ¥
- ä½ç½®ï¼š`src/database/config/`

#### æ•°æ®åº“è¡¨ç»“æ„

**è§’è‰²ç›¸å…³è¡¨ (8ä¸ª)**:
- `character_base_info` - è§’è‰²åŸºç¡€ä¿¡æ¯
- `character_cultivation` - ä¿®ç‚¼ä¿¡æ¯
- `character_equipment` - è£…å¤‡ä¿¡æ¯
- `character_inventory` - èƒŒåŒ…ç‰©å“
- `character_skills` - è§’è‰²æŠ€èƒ½
- `character_sect` - å®—é—¨ä¿¡æ¯
- `character_relationships` - äººç‰©å…³ç³»
- `character_achievements` - æˆå°±ç³»ç»Ÿ

**é™æ€æ•°æ®è¡¨ (9ä¸ª)**:
- `realm_data` - å¢ƒç•Œæ•°æ®
- `skill_data` - æŠ€èƒ½æ•°æ®
- `item_data` - ç‰©å“æ•°æ®
- `equipment_data` - è£…å¤‡æ•°æ®
- `sect_data` - å®—é—¨æ•°æ®
- `achievement_data` - æˆå°±æ•°æ®
- `cultivation_method_data` - åŠŸæ³•æ•°æ®
- `location_data` - åœ°ç‚¹æ•°æ®
- `npc_data` - NPCæ•°æ®

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ `src/types/` ä¸­å®šä¹‰ç›¸å…³ç±»å‹
2. åœ¨ `src/controllers/` ä¸­åˆ›å»ºæ§åˆ¶å™¨
3. åœ¨ `src/routes/` ä¸­æ·»åŠ è·¯ç”±
4. åœ¨ `src/pages/` ä¸­åˆ›å»ºå‰ç«¯é¡µé¢
5. æ›´æ–°å¯¼èˆªå’Œè·¯ç”±é…ç½®

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å†²çª**
   - å‰ç«¯é»˜è®¤ç«¯å£: 3004
   - åç«¯é»˜è®¤ç«¯å£: 3015
   - å¯åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ç«¯å£è®¾ç½®

2. **æ•°æ®åº“è¿æ¥é—®é¢˜**
   - ç¡®ä¿MySQLæœåŠ¡æ­£åœ¨è¿è¡Œ
   - æ£€æŸ¥æ•°æ®åº“é…ç½®ä¿¡æ¯æ˜¯å¦æ­£ç¡®
   - éªŒè¯ç”¨æˆ·æƒé™å’Œæ•°æ®åº“æ˜¯å¦å­˜åœ¨
   - æŸ¥çœ‹è¿æ¥æ± çŠ¶æ€ï¼š`GET /api/database/health`

3. **æ¨¡å—å¯¼å…¥é”™è¯¯**
   - ç¡®ä¿ä½¿ç”¨ `.js` æ‰©å±•åå¯¼å…¥ ES æ¨¡å—
   - æ£€æŸ¥ `tsconfig.json` é…ç½®
   - è¿è¡Œ `npm run build` ç¼–è¯‘TypeScriptæ–‡ä»¶

4. **CORS é”™è¯¯**
   - åç«¯å·²é…ç½® CORS æ”¯æŒ
   - ç¡®ä¿å‰åç«¯æœåŠ¡éƒ½åœ¨è¿è¡Œ

5. **TypeScript ç¼–è¯‘é”™è¯¯**
   - æ£€æŸ¥ç±»å‹å®šä¹‰æ˜¯å¦æ­£ç¡®
   - è¿è¡Œ `npm run build` æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
   - ç¡®ä¿æ‰€æœ‰å¿…éœ€å­—æ®µéƒ½å·²å®šä¹‰

6. **æ•°æ®åº“åˆå§‹åŒ–é—®é¢˜**
   - æ£€æŸ¥æ•°æ®åº“è¡¨æ˜¯å¦æ­£ç¡®åˆ›å»º
   - è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
   - éªŒè¯å¤–é”®çº¦æŸå’Œç´¢å¼•

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“è¿æ¥æ± **
   - é»˜è®¤æœ€å¤§è¿æ¥æ•°ï¼š10
   - æ ¹æ®å¹¶å‘éœ€æ±‚è°ƒæ•´ `connectionLimit`
   - ç›‘æ§è¿æ¥æ± ä½¿ç”¨æƒ…å†µ

2. **æŸ¥è¯¢ä¼˜åŒ–**
   - ä½¿ç”¨é€‚å½“çš„ç´¢å¼•
   - é¿å…N+1æŸ¥è¯¢é—®é¢˜
   - ä½¿ç”¨äº‹åŠ¡å¤„ç†å¤æ‚æ“ä½œ

3. **ç¼“å­˜ç­–ç•¥**
   - é™æ€æ•°æ®å¯è€ƒè™‘å†…å­˜ç¼“å­˜
   - é¢‘ç¹æŸ¥è¯¢çš„æ•°æ®ä½¿ç”¨Redisç¼“å­˜

### ç‰ˆæœ¬æ›´æ–°

æŸ¥çœ‹ [CHANGELOG.md](./CHANGELOG.md) äº†è§£è¯¦ç»†çš„ç‰ˆæœ¬æ›´æ–°ä¿¡æ¯å’Œç ´åæ€§å˜æ›´ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›é¡¹ç›®ï¼

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- åˆ›å»º GitHub Issue
- å‘é€é‚®ä»¶è‡³é¡¹ç›®ç»´æŠ¤è€…

---

**äº«å—ä¿®ä»™ä¹‹æ—…ï¼** ğŸ§™â€â™‚ï¸âœ¨